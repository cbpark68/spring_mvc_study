<?xml version="1.0" encoding="UTF-8"?>
<!-- <!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd"> -->
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">
 <sqlMap namespace="JspSpace">

	<typeAlias alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap" />
	<typeAlias alias="jspDeptVO" type="main.service.JspDeptVO"/>
	<typeAlias alias="jspEmpVO" type="main.service.JspEmpVO"/>
	<typeAlias alias="jspMemberVO" type="main.service.JspMemberVO"/>
	<typeAlias alias="jspBoardVO" type="main.service.JspBoardVO"/>

	<select id="jspDeptList" resultClass="egovMap">
		select deptno,dname,loc from dept order by deptno	
	</select>
	
	<insert id="jspDeptInsert">
		insert into dept (deptno,dname,loc) values (#deptno#,#dname#,#loc#)	
	</insert>

	<select id="jspDeptInfo" resultClass="jspDeptVO">
		select deptno,dname,loc from dept where deptno = #deptno#	
	</select>
	
	<update id="jspDeptUpdate">
		update dept set dname = #dname#,loc = #loc# where deptno = #deptno#	
	</update>
	
	<delete id="jspDeptDelete">
		delete from dept where deptno = #deptno#	
	</delete>
	
	<select id="jspDeptCount" resultClass="java.lang.Integer">
		select count(*) cnt from dept where deptno = #deptno#	
	</select>
	
	<insert id="jspEmpInsert">
		insert into emp (empno,ename,job,sal,hiredate,deptno)	
		values (#empno#,#ename#,#job#,#sal#,#hiredate#,#deptno#)	
	</insert>
	
	<select id="jspEmpIdCheck" resultClass="java.lang.Integer">
		select count(*) from emp where empno = #empno#	
	</select>
	
	<select id="jspEmpDeptnoCheck" resultClass="java.lang.Integer">
		select count(*) from dept where deptno = #deptno#	
	</select>
	
	<select id="jspEmpList" resultClass="egovMap">
		select a.empno,a.ename,a.job,a.sal,a.hiredate,b.dname deptno
		from emp a 
		left join dept b on b.deptno = a.deptno
		order by a.empno desc
	</select>
	
	<select id="jspEmpCount" resultClass="java.lang.Integer">
		select count(*) cnt from emp 
	</select>
	
	<select id="jspEmpGetEmpno" resultClass="java.lang.Integer">
		select ifnull(max(empno),1000)+1 empno from emp
	</select>
	
	<select id="jspEmpInfo" resultClass="jspEmpVO">
		select empno,ename,job,sal,hiredate,deptno from emp where empno = #empno#	
	</select>
	
	<update id="jspEmpUpdate">
		update emp set
		ename = #ename#,
		job = #job#,
		sal = #sal#,
		hiredate = #hiredate#,
		deptno = #deptno#	
		where empno = #empno#
	</update>
	
	<delete id="jspEmpDelete">
		delete from emp where empno = #empno#	
	</delete>
	
	<select id="jspMemberGetNo" resultClass="java.lang.Integer">
		select ifnull(max(member_no),1000)+1 member_no from member_tbl
	</select>
	
	<insert id="jspMemberInsert">
		insert into member_tbl ( member_no, member_id, member_name, member_grade, member_hobby, member_date)
		values( #member_no#, #member_id#, #member_name#, #member_grade#, #member_hobby#, #member_date#)
	</insert>

	<select id="jspMemberList" resultClass="egovMap">
	select
		member_no,
		member_id,
		member_name,
		if(member_grade='A','특별회원',if(member_grade='B','우수회원','일반회원')) member_grade ,
		member_hobby,
		date_format(member_date,'%Y.%m.%d') member_date
	from member_tbl
	order by member_no desc
	</select>
	
	<update id="jspMemberUpdate">
		update member_tbl set
		member_id     = #member_id#,
		member_name   = #member_name#,
		member_grade  = #member_grade#,
		member_hobby  = #member_hobby#,
		member_date	  = #member_date#
		where
		member_no     = #member_no#
	</update>
	
	<select id="jspMemberInfo" resultClass="jspMemberVO">
	select member_no, member_id, member_name, member_grade, member_hobby, member_date
	from member_tbl
	where member_no = #member_no#
	</select>
	
	<delete id="jspMemberDelete">
	delete from member_tbl
		where
		member_no     = #member_no#
	</delete>
	
	<select id="jspMemberNoCheck" resultClass="java.lang.Integer">
		select count(*) cnt from member_tbl where member_no = #member_no#
	</select>
	
	<select id="jspFriendList" resultClass="egovMap">
		select a.req_member_no member_no, b.member_name, a.req_date member_date
		from friend_tbl a
		left join member_tbl b on b.member_no = a.req_member_no
	</select>
	
	<insert id="jspBoardInsert">
		insert into board (title,pass,name,content)	
		values (#title#,#pass#,#name#,#content#)
	</insert>
</sqlMap>

